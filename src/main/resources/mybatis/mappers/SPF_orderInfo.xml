<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="SPF_orderInfo">

<insert id="insertorderinfo" parameterType="kr.ac.sungkyul.MDS.vo.OrderinfoVo">
	<!-- 주문 배송중인 상품을 삽입함 -->
		<![CDATA[
			insert into orderinfo values 
			(orderinfo_seq.nextval, #{orderinfo_count}, #{orderinfo_price}, #{orderinfo_address}, 
			sysdate, 2, #{product_no}, #{member_no}, #{productoption_no}, #{mall_no})
		]]>
	</insert>

	<select id="selectorder" parameterType="kr.ac.sungkyul.MDS.vo.BasketListVo"
		resultType="kr.ac.sungkyul.MDS.vo.BasketListVo">
		<!-- 주문 리스트를 가져옴 -->
	<![CDATA[
		select p.*, productimg.productimg_image from 
		(select b.*, product_name, product_price, (b.basket_count * product_price) total from 
		(select basket.*,productoption_color,productoption_size 
		from basket left join productoption 
		on basket.productoption_no = productoption.productoption_no 
		where basket.member_no=#{member_no } and basket.mall_no=#{mall_no }) b 
		left join product on b.product_no = product.product_no where product.product_state = 1) p 
		left join productimg on p.product_no = productimg.product_no where productimg_flag = 0
		]]>
	</select>

<delete id="deletebasket" parameterType="kr.ac.sungkyul.MDS.vo.BasketListVo">
		<!-- 장바구니에 있던 상품이 주문결제되면 장바구니의 상품을 삭제한다 -->
		<![CDATA[	
		delete from basket where basket_no = #{basket_no }
		]]>
	</delete>


</mapper>